<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hackathon â€” Relay Protocol</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Chivo:ital,wght@0,400;0,700;1,400&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ============================================================
   Relay Design System â€” Light Mode
   Tokens from design_tokens.md + component_library.md
   ============================================================ */

*{box-sizing:border-box;margin:0;padding:0}

:root{
  /* Violet (Brand Primary) â€” Light Mode */
  --violet-1:#FDFDFF;  --violet-2:#F7F8FF;  --violet-3:#EFF1FF;
  --violet-4:#E4E7FF;  --violet-5:#D7DBFF;  --violet-6:#C8CCFF;
  --violet-7:#B4B8FF;  --violet-8:#989AFF;  --violet-9:#4615C8;
  --violet-10:#3B00B4; --violet-11:#5A45DF; --violet-12:#2A226E;

  /* Slate (Neutral) â€” Light Mode */
  --slate-1:#FBFCFD;  --slate-2:#F8F9FA;  --slate-3:#F1F3F5;
  --slate-4:#ECEEF0;  --slate-5:#E6E8EB;  --slate-6:#DFE3E6;
  --slate-7:#D7DBDF;  --slate-8:#C1C8CD;  --slate-9:#889096;
  --slate-10:#7E868C; --slate-11:#687076; --slate-12:#11181C;

  /* Semantic â€” Light Mode */
  --grass-9:#46A758;  --grass-10:#3D9A50; --grass-11:#297C3B;
  --amber-9:#FFB224;  --amber-10:#FFA01C; --amber-11:#AD5700;
  --tomato-9:#DB4324; --tomato-10:#CA3214;--tomato-11:#341711;
  --indigo-9:#3E63DD; --indigo-11:#3451B2;

  /* Aliases */
  --bg:var(--slate-1);
  --surface:#FFFFFF;
  --surface-hover:var(--slate-2);
  --panel:#FFFFFF;
  --border:var(--slate-7);
  --border-light:var(--slate-6);
  --primary:var(--violet-9);
  --primary-hover:var(--violet-10);
  --primary-text:var(--violet-11);
  --primary-bg:var(--violet-3);
  --primary-border:var(--violet-7);
  --text:var(--slate-12);
  --text-dim:var(--slate-11);
  --text-faint:var(--slate-9);
  --text-ghost:var(--slate-6);
  --success:var(--grass-9);
  --warning:var(--amber-9);
  --error:var(--tomato-9);
  --info:var(--indigo-9);

  /* Typography */
  --font-display:'Chivo', sans-serif;
  --font-body:'Inter', sans-serif;

  /* Spacing (8px grid) */
  --sp-xs:4px; --sp-sm:8px; --sp-md:16px; --sp-lg:24px; --sp-xl:32px; --sp-2xl:48px; --sp-3xl:64px;

  /* Border Radius */
  --r-sm:4px; --r-md:8px; --r-lg:12px; --r-xl:16px; --r-full:9999px;
}

/* Selection */
::selection{background:rgba(70,21,200,.15)}

/* Scrollbar */
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--slate-8);border-radius:var(--r-sm)}

/* Base */
body{
  background:var(--bg);
  color:var(--text);
  font-family:var(--font-body);
  font-size:14px;
  line-height:1.5;
  min-height:100vh;
  -webkit-font-smoothing:antialiased;
}
a{color:var(--primary-text);text-decoration:none}
a:hover{text-decoration:underline}

/* Animations */
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes toastIn{from{opacity:0;transform:translateY(16px) scale(.96)}to{opacity:1;transform:translateY(0) scale(1)}}
@keyframes toastOut{from{opacity:1}to{opacity:0;transform:translateY(8px)}}

/* Layout */
.container{max-width:800px;margin:0 auto;padding:0 var(--sp-lg)}

/* ---- Header ---- */
header{border-bottom:1px solid var(--border-light);padding:var(--sp-xl) 0 var(--sp-lg)}
.header-top{display:flex;align-items:center;gap:var(--sp-md);margin-bottom:var(--sp-sm)}
.status-dot{
  width:10px;height:10px;border-radius:var(--r-full);flex-shrink:0;
  background:var(--primary);
  box-shadow:0 0 12px rgba(70,21,200,.35);
}
.header-title{
  font-family:var(--font-display);
  font-size:32px;
  font-weight:400;
  font-style:italic;
  color:var(--violet-12);
  letter-spacing:-.5px;
}
.header-meta{display:flex;align-items:center;justify-content:space-between;margin-top:var(--sp-xs)}
.header-repo{color:var(--text-faint);font-size:12px;letter-spacing:.5px}
.header-stats{display:flex;gap:var(--sp-md);font-size:12px;color:var(--text-faint)}
.header-stats .c-blue{color:var(--info)}
.header-stats .c-amber{color:var(--warning)}

/* ---- Tabs ---- */
.tabs{display:flex;gap:var(--sp-sm);margin-bottom:var(--sp-xl);flex-wrap:wrap}
.tab-btn{
  background:transparent;border:1px solid transparent;
  color:var(--text-faint);
  padding:var(--sp-sm) var(--sp-md);
  font-family:var(--font-body);font-size:14px;font-weight:500;
  cursor:pointer;border-radius:var(--r-md);
  transition:all .2s;
  display:flex;align-items:center;gap:var(--sp-sm);
}
.tab-btn:hover{color:var(--text-dim)}
.tab-btn.active{
  background:var(--violet-3);
  border-color:var(--violet-7);
  color:var(--violet-11);
}
.tab-icon{font-size:16px}
.tab-panel{display:none}
.tab-panel.active{display:block}

/* ---- Form Panel ---- */
.form-panel{
  background:var(--panel);
  border:1px solid var(--border-light);
  border-radius:var(--r-xl);
  padding:var(--sp-xl);
}
.form-heading{
  font-size:12px;
  color:var(--text-faint);
  letter-spacing:1.5px;
  text-transform:uppercase;
  margin-bottom:var(--sp-lg);
}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:var(--sp-md)}

/* ---- Fields ---- */
.field{margin-bottom:var(--sp-md)}
.field:last-child{margin-bottom:0}
.field-label{
  display:block;
  color:var(--text-dim);
  font-size:12px;
  font-weight:500;
  text-transform:uppercase;
  letter-spacing:1.5px;
  margin-bottom:var(--sp-sm);
}
.input{
  width:100%;
  padding:var(--sp-sm) var(--sp-md);
  background:var(--slate-3);
  border:1px solid var(--border);
  border-radius:var(--r-md);
  color:var(--text);
  font-family:var(--font-body);
  font-size:14px;
  outline:none;
  transition:border-color .2s;
}
.input:focus{border-color:var(--violet-7)}
.input::placeholder{color:var(--text-faint)}

/* ---- Divider ---- */
.or-divider{
  display:flex;align-items:center;gap:var(--sp-md);
  margin:var(--sp-xs) 0 var(--sp-md);
  color:var(--text-faint);
  font-size:12px;letter-spacing:1.5px;text-transform:uppercase;
}
.or-divider::before,.or-divider::after{content:'';flex:1;height:1px;background:var(--border-light)}

/* ---- Dropzone ---- */
.dropzone{
  border:2px dashed var(--border);
  border-radius:var(--r-md);
  padding:var(--sp-xl) var(--sp-lg);
  text-align:center;
  cursor:pointer;
  transition:all .25s;
}
.dropzone:hover,.dropzone.dragover{
  border-color:var(--primary);
  background:rgba(70,21,200,.04);
}
.dropzone.has-file{
  border-style:solid;
  border-color:var(--violet-6);
  background:rgba(70,21,200,.03);
}
.dropzone-icon{font-size:24px;margin-bottom:var(--sp-sm);opacity:.4}
.dropzone-text{color:var(--text-dim);font-size:14px}
.dropzone-text a{color:var(--primary-text);text-decoration:underline;cursor:pointer}
.dropzone-hint{color:var(--text-faint);font-size:12px;margin-top:var(--sp-sm)}
.dropzone-filename{color:var(--primary-text);font-size:14px;font-weight:600}
.dropzone input[type="file"]{display:none}
.dropzone-clear{
  background:none;border:none;
  color:var(--tomato-9);
  font-size:12px;font-family:var(--font-body);
  cursor:pointer;margin-top:var(--sp-sm);
  text-decoration:underline;
}
.dropzone-clear:hover{color:var(--tomato-10)}

/* ---- Buttons ---- */
.btn{
  border:none;
  padding:var(--sp-sm) var(--sp-lg);
  border-radius:var(--r-md);
  font-family:var(--font-body);
  font-size:16px;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:.5px;
  cursor:pointer;
  transition:all .2s;
  color:#fff;
}
.btn-primary{background:var(--primary)}
.btn-primary:hover{background:var(--primary-hover);box-shadow:0 4px 16px rgba(70,21,200,.2)}

.btn-sm{
  padding:var(--sp-sm) var(--sp-md);
  border-radius:var(--r-md);
  font-family:var(--font-body);
  font-size:12px;
  font-weight:600;
  cursor:pointer;
  transition:all .2s;
  border:none;
  background:transparent;
}
.btn-clear{border:1px solid rgba(219,67,36,.2);color:var(--tomato-9)}
.btn-clear:hover{background:rgba(219,67,36,.06)}
.btn-export{
  background:rgba(70,21,200,.06);
  border:1px solid rgba(70,21,200,.15);
  color:var(--primary-text);
}
.btn-export:hover{background:rgba(70,21,200,.12)}
.btn-download-all{
  background:rgba(255,178,36,.06);
  border:1px solid rgba(255,178,36,.2);
  color:var(--amber-11);
}
.btn-download-all:hover{background:rgba(255,178,36,.12)}

/* ---- Section Bar ---- */
.section-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--sp-md);flex-wrap:wrap;gap:var(--sp-sm)}
.section-title{font-size:12px;color:var(--text-faint);letter-spacing:1.5px;text-transform:uppercase}
.section-actions{display:flex;gap:var(--sp-sm);flex-wrap:wrap}

/* ---- Gallery ---- */
.gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:var(--sp-md)}

/* ---- Cards ---- */
.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--r-lg);
  overflow:hidden;
  transition:all .25s;
  display:flex;flex-direction:column;
  position:relative;
  animation:fadeIn .4s ease both;
}
.card:hover{background:var(--surface-hover);transform:translateY(-2px)}
.card.is-link:hover{border-color:rgba(62,99,221,.25);box-shadow:0 8px 24px rgba(62,99,221,.08)}
.card.is-skill:hover{border-color:rgba(255,178,36,.25);box-shadow:0 8px 24px rgba(255,178,36,.08)}

.card-bar{height:3px;opacity:.4;transition:opacity .25s}
.card:hover .card-bar{opacity:1}
.card.is-link .card-bar{background:linear-gradient(90deg,var(--indigo-9),var(--violet-9))}
.card.is-skill .card-bar{background:linear-gradient(90deg,var(--amber-9),var(--amber-10))}

.card-thumb{height:96px;display:flex;align-items:center;justify-content:center;position:relative}
.card.is-link .card-thumb{background:linear-gradient(135deg,rgba(62,99,221,.08),rgba(70,21,200,.05))}
.card.is-skill .card-thumb{background:linear-gradient(135deg,rgba(255,178,36,.08),rgba(255,160,28,.04))}
.card-thumb-icon{font-size:32px;opacity:.5}

.card-badge{
  position:absolute;top:var(--sp-sm);left:var(--sp-sm);
  padding:var(--sp-xs) var(--sp-sm);
  border-radius:var(--r-sm);
  font-size:10px;font-weight:700;
  text-transform:uppercase;letter-spacing:1.5px;
}
.card.is-link .card-badge{background:rgba(62,99,221,.1);color:var(--indigo-11)}
.card.is-skill .card-badge{background:rgba(255,178,36,.12);color:var(--amber-11)}

.card-delete{
  position:absolute;top:var(--sp-sm);right:var(--sp-sm);
  background:rgba(255,255,255,.7);
  border:none;color:var(--slate-9);cursor:pointer;
  font-size:14px;width:24px;height:24px;
  border-radius:var(--r-sm);
  display:flex;align-items:center;justify-content:center;
  transition:all .2s;opacity:0;
}
.card:hover .card-delete{opacity:1;color:var(--tomato-9)}

.card-body{padding:var(--sp-md);flex:1;display:flex;flex-direction:column;gap:var(--sp-sm)}
.card-title{color:var(--text);font-size:14px;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.card-domain{font-size:12px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.card.is-link .card-domain{color:var(--primary-text)}
.card.is-skill .card-domain{color:var(--amber-10)}
.card-desc{color:var(--text-dim);font-size:12px;line-height:1.5;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}

.card-dl-btn{
  display:block;width:100%;
  padding:var(--sp-sm) 0;margin-top:var(--sp-sm);
  background:rgba(255,178,36,.06);
  border:1px solid rgba(255,178,36,.2);
  color:var(--amber-11);
  font-family:var(--font-body);font-size:12px;font-weight:600;
  border-radius:var(--r-md);cursor:pointer;
  transition:all .2s;text-align:center;letter-spacing:.5px;
}
.card-dl-btn:hover{background:rgba(255,178,36,.12);box-shadow:0 0 12px rgba(255,178,36,.08)}

.card-footer{display:flex;justify-content:space-between;align-items:flex-end;gap:var(--sp-sm);margin-top:auto;padding-top:var(--sp-xs)}
.card-tags{display:flex;gap:var(--sp-xs);flex-wrap:wrap;flex:1;min-width:0}
.card-tag{
  background:rgba(70,21,200,.05);
  border:1px solid rgba(70,21,200,.1);
  color:var(--primary-text);
  padding:var(--sp-xs) var(--sp-sm);
  border-radius:var(--r-sm);font-size:10px;
}
.card-tag-more{color:var(--text-faint);font-size:10px}
.card-time{color:var(--text-faint);font-size:10px;white-space:nowrap}

/* ---- Empty ---- */
.empty{text-align:center;padding:var(--sp-2xl) var(--sp-lg);color:var(--text-faint)}
.empty-icon{font-size:36px;margin-bottom:var(--sp-md);opacity:.3}
.empty-hint{font-size:12px;margin-top:var(--sp-sm);color:var(--text-ghost)}

/* ---- Toast ---- */
.toast{
  position:fixed;bottom:var(--sp-xl);right:var(--sp-xl);
  padding:var(--sp-sm) var(--sp-lg);
  border-radius:var(--r-md);
  font-size:14px;font-weight:600;
  z-index:9999;
  animation:toastIn .35s cubic-bezier(.21,1.02,.55,1);
  font-family:var(--font-body);
}
.toast.success{background:var(--success);color:#fff;box-shadow:0 4px 16px rgba(70,167,88,.25)}
.toast.error{background:var(--error);color:#fff;box-shadow:0 4px 16px rgba(219,67,36,.25)}
.toast.hiding{animation:toastOut .3s ease forwards}

/* ---- Responsive ---- */
@media(max-width:768px){
  .container{padding:0 var(--sp-md)}
  .form-panel{padding:var(--sp-lg)}
  .form-row{grid-template-columns:1fr}
  .header-title{font-size:24px}
  .gallery{grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:var(--sp-sm)}
  .section-bar{flex-direction:column;align-items:flex-start}
}
</style>
</head>
<body>

<header>
  <div class="container">
    <div class="header-top">
      <div class="status-dot"></div>
      <h1 class="header-title">Hackathon</h1>
    </div>
    <div class="header-meta">
      <div class="header-repo">RELAY PROTOCOL Â· <a href="https://github.com/relayprotocol/knowledge-base" target="_blank">github.com/relayprotocol/knowledge-base</a></div>
      <div class="header-stats">
        <span><span class="c-blue" id="stat-links">0</span> links</span>
        <span><span class="c-amber" id="stat-skills">0</span> skills</span>
      </div>
    </div>
  </div>
</header>

<main class="container" style="padding-top:32px;padding-bottom:80px">

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" data-tab="upload"><span class="tab-icon">â†‘</span> Upload</button>
    <button class="tab-btn" data-tab="library"><span class="tab-icon">â—Ž</span> Library</button>
  </div>

  <!-- Upload Tab -->
  <div class="tab-panel active" id="tab-upload">
    <div class="form-panel">
      <div class="form-heading">Add to the Hackathon</div>

      <div class="field">
        <label class="field-label">Paste a Link</label>
        <input class="input" type="text" id="input-url" placeholder="https://example.com/resource">
      </div>

      <div class="or-divider">or</div>

      <div class="field">
        <label class="field-label">Upload a Skill</label>
        <div class="dropzone" id="dropzone">
          <input type="file" id="file-input" accept=".md,.txt,.json,.yaml,.yml,.py,.js,.ts,.zip">
          <div class="dropzone-icon" id="dz-icon">â†‘</div>
          <div id="dz-label">
            <div class="dropzone-text">Drop your skill file here or <a>browse</a></div>
            <div class="dropzone-hint">.md Â· .json Â· .yaml Â· .py Â· .js Â· .ts Â· .zip</div>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="field">
          <label class="field-label">Name (optional)</label>
          <input class="input" type="text" id="input-name" placeholder="Give it a name">
        </div>
        <div class="field">
          <label class="field-label">Description (optional)</label>
          <input class="input" type="text" id="input-desc" placeholder="Brief description">
        </div>
      </div>

      <button class="btn btn-primary" id="btn-submit">ADD TO Hackathon</button>
    </div>
  </div>

  <!-- Library Tab -->
  <div class="tab-panel" id="tab-library">
    <div id="gallery-section" style="display:none">
      <div class="section-bar">
        <div class="section-title" id="gallery-count">0 ENTRIES</div>
        <div class="section-actions">
          <button class="btn-sm btn-clear" id="btn-clear">Clear All</button>
          <button class="btn-sm btn-download-all" id="btn-download-all" style="display:none">â†“ Download All Skills</button>
          <button class="btn-sm btn-export" id="btn-export">â†“ Export JSON for GitHub</button>
        </div>
      </div>
      <div class="gallery" id="gallery"></div>
    </div>
    <div id="gallery-empty" class="empty">
      <div class="empty-icon">â—Ž</div>
      <div style="font-size:14px">No entries yet</div>
      <div class="empty-hint">Switch to Upload to add links or skills</div>
    </div>
  </div>

</main>
<div id="toast-container"></div>

<script>
(function(){
  var SK='relay-kb-submissions', subs=[], fileData={name:'',content:'',size:0};

  function genId(){return Date.now().toString(36)+Math.random().toString(36).slice(2,8)}
  function timeAgo(ts){
    var s=Math.floor((Date.now()-ts)/1000);
    if(s<60)return'just now';if(s<3600)return Math.floor(s/60)+'m ago';
    if(s<86400)return Math.floor(s/3600)+'h ago';return Math.floor(s/86400)+'d ago';
  }
  function isValidUrl(s){try{var u=new URL(s);return u.protocol==='http:'||u.protocol==='https:'}catch(e){return false}}
  function esc(s){var d=document.createElement('div');d.textContent=s;return d.innerHTML}
  function load(){try{subs=JSON.parse(localStorage.getItem(SK)||'[]')}catch(e){subs=[]}}
  function save(){localStorage.setItem(SK,JSON.stringify(subs))}

  function toast(msg,type){
    type=type||'success';
    var el=document.createElement('div');
    el.className='toast '+type;
    el.textContent=(type==='success'?'âœ“ ':'âœ— ')+msg;
    document.getElementById('toast-container').appendChild(el);
    setTimeout(function(){el.classList.add('hiding')},2800);
    setTimeout(function(){el.remove()},3200);
  }

  function updateCounts(){
    document.getElementById('stat-links').textContent=subs.filter(function(s){return s.type==='link'}).length;
    document.getElementById('stat-skills').textContent=subs.filter(function(s){return s.type==='skill'}).length;
  }

  // Tabs
  var tabBtns=document.querySelectorAll('.tab-btn');
  tabBtns.forEach(function(btn){
    btn.addEventListener('click',function(){
      tabBtns.forEach(function(b){b.classList.remove('active')});
      btn.classList.add('active');
      document.querySelectorAll('.tab-panel').forEach(function(p){p.classList.remove('active')});
      document.getElementById('tab-'+btn.getAttribute('data-tab')).classList.add('active');
      if(btn.getAttribute('data-tab')==='library') renderGallery();
    });
  });

  // Dropzone
  var dz=document.getElementById('dropzone'), fi=document.getElementById('file-input');
  dz.addEventListener('click',function(){fi.click()});
  dz.addEventListener('dragover',function(e){e.preventDefault();dz.classList.add('dragover')});
  dz.addEventListener('dragleave',function(){dz.classList.remove('dragover')});
  dz.addEventListener('drop',function(e){e.preventDefault();dz.classList.remove('dragover');if(e.dataTransfer.files[0])pickFile(e.dataTransfer.files[0])});
  fi.addEventListener('change',function(){if(fi.files[0])pickFile(fi.files[0])});

  function pickFile(f){
    fileData.name=f.name;fileData.size=f.size;
    var r=new FileReader();
    r.onload=function(e){fileData.content=e.target.result};
    r.readAsText(f);
    dz.classList.add('has-file');
    document.getElementById('dz-icon').textContent='ðŸ“„';
    document.getElementById('dz-label').innerHTML='<div class="dropzone-filename">'+esc(f.name)+'</div><button class="dropzone-clear" id="dz-clear">Remove file</button>';
    document.getElementById('dz-clear').addEventListener('click',function(e){e.stopPropagation();resetFile()});
  }
  function resetFile(){
    fileData={name:'',content:'',size:0};fi.value='';
    dz.classList.remove('has-file');
    document.getElementById('dz-icon').textContent='â†‘';
    document.getElementById('dz-label').innerHTML='<div class="dropzone-text">Drop your skill file here or <a>browse</a></div><div class="dropzone-hint">.md Â· .json Â· .yaml Â· .py Â· .js Â· .ts Â· .zip</div>';
  }

  // Submit
  document.getElementById('btn-submit').addEventListener('click',function(){
    var url=document.getElementById('input-url').value.trim();
    var hasFile=!!fileData.name;
    var name=document.getElementById('input-name').value.trim();
    var desc=document.getElementById('input-desc').value.trim();

    if(!url&&!hasFile)return toast('Paste a link or upload a skill file','error');

    if(url){
      if(!isValidUrl(url))return toast('Enter a valid URL','error');
      var host='';try{host=new URL(url).hostname}catch(e){host=url}
      subs.unshift({id:genId(),type:'link',url:url,title:name||host,description:desc,tags:[],createdAt:Date.now()});
    }
    if(hasFile){
      subs.unshift({id:genId(),type:'skill',title:name||fileData.name.replace(/\.[^.]+$/,''),description:desc,tags:[],fileName:fileData.name,fileSize:fileData.size,fileContent:fileData.content,createdAt:Date.now()});
    }

    save();updateCounts();
    document.getElementById('input-url').value='';
    document.getElementById('input-name').value='';
    document.getElementById('input-desc').value='';
    resetFile();
    toast(url&&hasFile?'Link and skill added':url?'Link added':'Skill added');
  });

  // Download helper
  function dlFile(name,content){
    var blob=new Blob([content],{type:'application/octet-stream'});
    var url=URL.createObjectURL(blob);
    var a=document.createElement('a');
    a.style.display='none';
    a.href=url;
    a.download=name;
    document.body.appendChild(a);
    a.click();
    setTimeout(function(){document.body.removeChild(a);URL.revokeObjectURL(url)},250);
  }

  // Gallery render
  function renderGallery(){
    var sec=document.getElementById('gallery-section');
    var gal=document.getElementById('gallery');
    var empty=document.getElementById('gallery-empty');
    var dlAll=document.getElementById('btn-download-all');
    var skills=subs.filter(function(s){return s.type==='skill'&&s.fileContent});

    if(!subs.length){sec.style.display='none';empty.style.display='';return}

    sec.style.display='';empty.style.display='none';
    dlAll.style.display=skills.length?'':'none';
    document.getElementById('gallery-count').textContent=subs.length+' ENTRIES';

    var html='';
    for(var i=0;i<subs.length;i++){
      var item=subs[i];
      var isLink=item.type==='link';
      var domain='';try{domain=new URL(item.url).hostname.replace('www.','')}catch(e){}
      var title=esc(item.title||item.url||item.fileName||'Untitled');
      var titleAttr=esc(item.title||item.url||item.fileName||'');

      var dlBtn='';
      if(!isLink){
        dlBtn='<button class="card-dl-btn" data-dl="'+item.id+'">â†“ Download Skill</button>';
      }

      html+='<div class="card '+(isLink?'is-link':'is-skill')+'" style="animation-delay:'+i*0.04+'s">';
      html+='<div class="card-bar"></div>';
      html+='<div class="card-thumb"><div class="card-thumb-icon">'+(isLink?'ðŸ”—':'âš¡')+'</div>';
      html+='<span class="card-badge">'+(isLink?'Link':'Skill')+'</span>';
      html+='<button class="card-delete" data-del="'+item.id+'" title="Remove">Ã—</button></div>';
      html+='<div class="card-body">';
      html+='<div class="card-title" title="'+titleAttr+'">'+title+'</div>';
      if(isLink&&domain)html+='<div class="card-domain">'+esc(domain)+'</div>';
      if(!isLink&&item.fileName)html+='<div class="card-domain">ðŸ“„ '+esc(item.fileName)+'</div>';
      if(item.description)html+='<div class="card-desc">'+esc(item.description)+'</div>';
      html+=dlBtn;
      html+='<div class="card-footer"><div class="card-tags"></div><span class="card-time">'+timeAgo(item.createdAt)+'</span></div>';
      html+='</div></div>';
    }
    gal.innerHTML=html;
  }

  // Gallery click delegation
  document.getElementById('gallery').addEventListener('click',function(e){
    var dlBtn=e.target.closest('[data-dl]');
    if(dlBtn){
      var item=subs.find(function(s){return s.id===dlBtn.getAttribute('data-dl')});
      if(item&&item.fileContent){
        dlFile(item.fileName||'skill.txt',item.fileContent);
        toast('Downloaded '+(item.fileName||'skill'));
      }else{
        toast('No file content to download','error');
      }
      return;
    }
    var delBtn=e.target.closest('[data-del]');
    if(delBtn){
      subs=subs.filter(function(s){return s.id!==delBtn.getAttribute('data-del')});
      save();updateCounts();renderGallery();toast('Removed');
    }
  });

  // Bulk download
  document.getElementById('btn-download-all').addEventListener('click',function(){
    var skills=subs.filter(function(s){return s.type==='skill'&&s.fileContent});
    if(!skills.length)return toast('No skills to download','error');
    if(skills.length===1){dlFile(skills[0].fileName||'skill.txt',skills[0].fileContent);return toast('Downloaded '+(skills[0].fileName||'skill'))}
    var bundle={exportedAt:new Date().toISOString(),totalSkills:skills.length,skills:skills.map(function(s){return{id:s.id,title:s.title,fileName:s.fileName,description:s.description,fileContent:s.fileContent,createdAt:new Date(s.createdAt).toISOString()}})};
    dlFile('relay-skills-bundle-'+Date.now()+'.json',JSON.stringify(bundle,null,2));
    toast('Downloaded '+skills.length+' skills as bundle');
  });

  // Clear
  document.getElementById('btn-clear').addEventListener('click',function(){subs=[];save();updateCounts();renderGallery();toast('All entries cleared')});

  // Export
  document.getElementById('btn-export').addEventListener('click',function(){
    var p={repository:'relayprotocol/knowledge-base',exportedAt:new Date().toISOString(),totalEntries:subs.length,entries:subs.map(function(s){var o={id:s.id,type:s.type,title:s.title,description:s.description,tags:s.tags,createdAt:new Date(s.createdAt).toISOString()};if(s.url)o.url=s.url;if(s.fileName)o.fileName=s.fileName;if(s.fileContent)o.fileContent=s.fileContent;return o})};
    dlFile('relay-kb-export-'+Date.now()+'.json',JSON.stringify(p,null,2));
    toast('Exported â€” ready to push to GitHub');
  });

  load();updateCounts();
})();
</script>

</body>
</html>
